<!-- 
                                      TEAM VEGA 
                         REAL TIME BACK END FOR MONITORING CAR DATA
 -->
<!doctype html>

<html>
  <head>
    <title>VEGA </title>

    <!-- Websocket IO -->
    <script src="https://cdn.socket.io/socket.io-1.2.0.js"></script>
    <script src="http://code.jquery.com/jquery-1.11.1.js"></script>
    <!-- ANUGULAR SPEEDOMETER AND HOME COMPONENTS-->
    <!-- Battry_Chart Imports -->
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/modules/exporting.js"></script>
    <script src="https://code.highcharts.com/modules/solid-gauge.js"></script>
    <script src="http://code.highcharts.com/stock/highstock.src.js"></script>
    <script src="https://code.highcharts.com/modules/solid-gauge.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script src="https://code.highcharts.com/highcharts-more.js"></script>
    <script src="https://code.highcharts.com/modules/solid-gauge.js"></script>



<!-- JavaScript -->
    <!-- <script src="//cdn.jsdelivr.net/alertifyjs/1.8.0/alertify.min.js"></script> -->

<!-- CSS -->
    <link rel="stylesheet" href="//cdn.jsdelivr.net/alertifyjs/1.8.0/css/alertify.min.css"/>
<!-- <link rel="stylesheet" type="text/css" href="css/alertify.min.css" /> -->



    <!-- Tabs -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<!-- Resources -->

    <!-- Local SPEEDO METER -->
  <!-- <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC2M8AYQwpG9mPx3SGAqqDUMiUfIuHgrCI&sensor=true"> -->
     </script>


    <!--     <link href="CSS/battryChart.css" rel="stylesheet"> -->

    <!-- local JS files -->
    <script type="text/javascript" src="battryChart.js"></script>
   <!--  <script type="text/javascript">
      var myapp = angular.module('myapp', ["highcharts-ng"]);
    </script> -->

    <style>
     body{ 
      padding-top:1px;
      background-image:url("../public/back.jpg");
      }
      .navbar{
       min-height:20px; 
       /*or whatever height you require*/
      }
      .six-sec-ease-in-out {
      -webkit-transition: width 6s ease-in-out;
      -moz-transition: width 6s ease-in-out;
      -ms-transition: width 6s ease-in-out;
      -o-transition: width 6s ease-in-out;
      transition: width 6s ease-in-out;
      }
      .container { margin-top: 50px; }
      .progress-bar-vertical {
        width: 50px;
        min-height: 500px;
        display: flex;
        align-items: flex-end;
        margin-right: 20px;
        float: left;
      }
      .progress-bar-vertical .progress-bar {
        width: 100%;
        height: 0;
        -webkit-transition: height 0.6s ease;
        -o-transition: height 0.6s ease;
        transition: height 0.6s ease;
      }
      .label {
        font-size: 23px;
        font-style: italic;
      }
      .row {margin-top: 35px;}
      .nopadding {
      padding: 0;
      margin: 0;
      }
    </style>

    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <style type="text/css">
      html { height: 100%; }
      body { height: 100%;}
      #map_canvas { 

        height: 100%;
        
      }
      /*border: 3px solid #73AD21;*/
      }
      #temp{
      position: absolute;
      z-index: 999;  
      }
    </style>
        <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC2M8AYQwpG9mPx3SGAqqDUMiUfIuHgrCI&sensor=true">
    </script>

  </head>
  <body onload="javascript:Init()" ng-controller="demoController as dm" style="background-color:#262626;color:white;">
  <!-- Tabs -->

  <nav class="navbar navbar-default" style="font-family: Lucida Sans Unicode, Lucida Grande, sans-serif;">
    <div class="container-fluid">
      <div class="navbar-header">
        <a class="navbar-brand" href="index.html">VEGA</a>
        <!-- <img src="public/vega.jpg" /> -->
      </div>

      <ul class="nav navbar-nav">
        <li class="active"><a href="javascript:void(0)" class="tablinks" onclick="openCity(event, 'home')">Home</a></li>
        <li><a href="javascript:void(0)" class="tablinks" onclick="openCity(event, 'battery')">Battery</a></li>
        <li><a href="javascript:void(0)" class="tablinks" onclick="openCity(event, 'data')">CAN Message</a></li>
        <li><a href="javascript:void(0)" class="tablinks" onclick="openCity(event, 'Debug')">Debug</a></li>
      </ul>

    </div>
  </nav>
            
      </div>
    <!-- Tab Paris -->

      <div id="battery" class="tabcontent">

        <div style="">
            <nav class="navbar navbar-inverse" style="height: 30">
            <ul class="nav nav-pills" role="tablist" >

            <li role="presentation" class="active"><a href="#">Maximum Temperature <span id = "data_one" class="badge">Loading</span></a></li>
            <li role="presentation" class="active"><a href="#">Minimum Temperature <span id = "data_two" class="badge">Loading</span></a></li>
            <li role="presentation" class="active"><a href="#">Maximum Voltage <span id = "data_three" class="badge">Loading</span></a></li>
            <li role="presentation" class="active"><a href="#">Minimum Voltage <span id = "data_four" class="badge">Loading</span></a></li>
            <li role="presentation" class="active"><a href="#">Max Currnt <span id = "data_five" class="badge">Loading</span></a></li>


             </ul>
            </nav>

       </div>
          <div class="alert alert-success" style="width: 30%;">
              <span>
              <a href="#" id = "msg" class="close" data-dismiss="alert" aria-label="close">&times;</a>
              <strong>Success!</strong> Data Recieved.
              </span>
          </div>    


        <div class = "row">
            <div class= "col-md-1">
                <div class="list-group nopadding" style="float:left;width: 100%;font-size:12px;white-space: nowrap;">          
                    <a onclick="battery_caller(1);" class="list-group-item">Battery 1</a>
                    <a onclick="battery_caller(2);" class="list-group-item">Battery 2</a>
                    <a href="" class="list-group-item">Battery 3</a>
                    <a href="#" class="list-group-item">Battery 4</a>
                    <a href="#" class="list-group-item">Battery 5</a>
                    <a href="#" class="list-group-item">Battery 6</a>
                    <a href="#" class="list-group-item">Battery 7</a>
                    <a href="#" class="list-group-item">Battery 8</a>
                    <a href="#" class="list-group-item">Battery 9</a>
                    <a href="#" class="list-group-item">Battery 10</a>  
                    <a href="#" class="list-group-item">Battery 11</a>
                    <a href="#" class="list-group-item">Battery 12</a>
                </div>
            </div>
             <div class= "col-md-6 nopadding">
                     <!--   battry Chart -->
                    <div id="battryChart nopadding" style="width: 100%;">
                    <div  id="container" style="min-width: 310px;height: 400px; ">
            </div>
            </div>
            </div>
            <div class= "col-md-5 nopadding">
                <div id="temp" style="width: 97%;"></div>
            </div>
        </div>
        <div class = "row">
        <center>

        <button type="button" class="btn btn-success" onclick="max_up();" style="width: 10%;">Max Up</button>
        <button type="button" class="btn btn-success" onclick="max_down();" style="width: 10%;">Max Down</button>
        <button type="button" class="btn btn-success" onclick="min_up();" style="width: 10%;">Min Up</button>
        <button type="button" class="btn btn-success" onclick="min_down();" style="width: 10%;">Min Down</button>

        </center>
        </div>
      </div>

  <div id="data" class="tabcontent">

      <span>
       <ul class="list-group" style="width: 12%;float:left;">
      </ul>
      <ul class="list-group" style="width: 20%;float:left;">
        <li class="list-group-item list-group-item-success">IGBT 1</li>
        <li class="list-group-item list-group-item-success">IGBT 2</li>
        <li class="list-group-item list-group-item-success">IGBT 3</li>
        <li class="list-group-item list-group-item-danger">Motor Temperature</li>
        <li class="list-group-item list-group-item-danger">Heat Sink Temperature</li>
        <li class="list-group-item list-group-item-info">VS</li>
        <li class="list-group-item list-group-item-info">IS</li>
        <li class="list-group-item list-group-item-warning">BUS Currnt</li>
        <li class="list-group-item list-group-item-warning">BUS V1</li>
        <li class="list-group-item list-group-item-warning">BUS V2</li>
        <li class="list-group-item list-group-item-warning">Motor Power</li>

      </ul>
      <ul class="list-group" style="width: 10%;float:left;">
        <li id = "can0_1" class="list-group-item list-group-item-success">0</li>
        <li id = "can1_1" class="list-group-item list-group-item-success">0</li>
        <li id = "can2_1" class="list-group-item list-group-item-success">0</li>
        <li id = "can3_1" class="list-group-item list-group-item-danger">0</li>
        <li id = "can4_1" class="list-group-item list-group-item-danger">0</li>
        <li id = "can5_1" class="list-group-item list-group-item-info">0</li>
        <li id = "can6_1" class="list-group-item list-group-item-info">0</li>
        <li id = "can7_1" class="list-group-item list-group-item-warning">0</li>
        <li id = "can8_1" class="list-group-item list-group-item-warning">0</li>
        <li id = "can9_1" class="list-group-item list-group-item-warning">0</li>
        <li id = "can10_1" class="list-group-item list-group-item-warning">0</li>

      </ul>
      <ul class="list-group" style="width: 2%;float:left;">
      </ul>
      <ui class="list-group" style="width: 23%;float:right;"></ui>
       <ul class="list-group" style="width: 20%;float:left;">
        <li class="list-group-item list-group-item-success">IGBT 1</li>
        <li class="list-group-item list-group-item-success">IGBT 2</li>
        <li class="list-group-item list-group-item-success">IGBT 3</li>
        <li class="list-group-item list-group-item-danger">Motor Temperature</li>
        <li class="list-group-item list-group-item-danger">Heat Sink Temperature</li>
        <li class="list-group-item list-group-item-info">VS</li>
        <li class="list-group-item list-group-item-info">IS</li>
        <li class="list-group-item list-group-item-warning">BUS Currnt</li>
        <li class="list-group-item list-group-item-warning">BUS V1</li>
        <li class="list-group-item list-group-item-warning">BUS V2</li>
        <li class="list-group-item list-group-item-warning">Motor Power</li>

      </ul>
      <ul class="list-group" style="width: 10%;float:left;">
        <li id = "can0_2" class="list-group-item list-group-item-success">0</li>
        <li id = "can1_2" class="list-group-item list-group-item-success">0</li>
        <li id = "can2_2" class="list-group-item list-group-item-success">0</li>
        <li id = "can3_2" class="list-group-item list-group-item-danger">0</li>
        <li id = "can4_2" class="list-group-item list-group-item-danger">0</li>
        <li id = "can5_2" class="list-group-item list-group-item-info">0</li>
        <li id = "can6_2" class="list-group-item list-group-item-info">0</li>
        <li id = "can7_1" class="list-group-item list-group-item-warning">0</li>
        <li id = "can8_1" class="list-group-item list-group-item-warning">0</li>
        <li id = "can9_1" class="list-group-item list-group-item-warning">0</li>
        <li id = "can10_1" class="list-group-item list-group-item-warning">0</li>

      </ul>
      <ui class="list-group" style="width: 23%;float:right;"></ui>
      </span>    
      <table id="trip_events" class="table table-sm table-inverse">
      
      <tr>
        <td>Error</td>
        <td>Messege</td>
      </tr>
      </table>

  </div>

      <!-- battryChart_end --> 
      <ng-gauge size="200" type="full" thick="5" value="68.2" cap="round" label="Speed"  foreground-color="#131313" background-color="rgba(255,255,255, 0.4)" append="mph"></ng-gauge>

    </div>
    <div id="home" class="tabcontent" style="width: 20%;">


    <div class="container">

     <div style="">
            <nav class="navbar navbar-inverse" style="height: 25">
            <ul class="nav nav-pills" role="tablist" >

            <li role="presentation" class="active"><a href="#">Maximum Temp <span id = "data_one_home" class="badge">Loading</span></a></li>
            <li role="presentation" class="active"><a href="#">Minimum Temp <span id = "data_two_home" class="badge">Loading</span></a></li>
            <li role="presentation" class="active"><a href="#">Maximum Vol <span id = "data_three_home" class="badge">Loading</span></a></li>
            <li role="presentation" class="active"><a href="#">Minimum Vol <span id = "data_four_home" class="badge">Loading</span></a></li>
            <li role="presentation" class="active"><a href="#">Minimum Vol <span id = "data_five_home" class="badge">Loading</span></a></li>


             </ul>
            </nav>

       </div>
          <div class="row"">
            <div class="col-md-3">
              <div>
              <div>
              <highchart id="container-torque" config="chartConfig" style="width:250px;height:220px;float:left">
              </div>
              <br><br>
              <div>
              <highchart id="container-speed" config="chartConfig" style="width:250px;height:220px;float:left">
              </div>              
              </div>
            </div>
            <div class="col-md-3">
              <div>
              <highchart id="rcontainer-torque" config="chartConfig" style="width:250px;height:220px;float:left">
              </div>

              <div>
              <highchart id="container-rpm" config="chartConfig" style="width:250px;height:220px;float:left">
              </div>
            </div>
            </div>

    </div>
    </div>

     <!-- Tab Debug-->
   <!-- Tab Debug-->

  
   <div id="Debug" class="tabcontent">
       <div id="sTitle" style="margin: 20px;
                               font-size: 20px;
                               font-family: Lucida Sans Unicode, Lucida Grande, sans-serif;" > Data Received 
       </div>
       <div id="test" style="margin-left: 80px; 
                             border: 2px solid black;
                             border-radius: 10px; 
                             width:1150px;
                             height: 200px;
                             overflow: scroll;
                             font-size: 18px;
                             padding-left: 10px;
                             border-width: 1px;">
       </div>
       <div id="sTitle2" style="margin: 20px;
                             font-size: 20px;
                             font-family: Lucida Sans Unicode, Lucida Grande, sans-serif;" > Send Data to Xbee 
       </div>
       <div id="test2" style="margin-left: 80px; 
                               border: 2px solid black;
                               border-radius: 10px; 
                               width:1150px;
                               height: 200px;
                               overflow: scroll;
                               font-size: 18px;
                               padding-left: 10px;
                               border-width: 1px;">
        </div>
   </div>
  
    <script>

    var chart;
    var chat_battery;


    var x = [];
    var y = [];

    var batt_id;
    var temp_id;
    var batt_plotter;
    var temp_plotter;

    var batt_plotter_selector;
    var temp_plotter_selector;

    var batt = [];
    var temp = [];
    var arr3 = [];
    var can_l = [];
    var can_r = [];
    var can;
    var l1;
    var l2;
    var consta = Math.pow(2, -24);
    var lef_T,right_T;
    var tor;

    var max_currnt_all;
    var max_Temp;
    var min_vol;
    var min_Temp;
    var max_vol;

    var range_max;
    var range_low;

    var c1igbt0;
    var c1igbt1;
    var c1igbt2;

    var c1motor;
    var c1bv1;
    var c1bv2;
    var c1bi;
    var c1heat;
    var c1vs;
    var c1is;
    var c1_trip_message;

    var c2igbt0;
    var c2igbt1;
    var c2igbt2;
    
    var c2motor;
    var c2bv1;
    var c2bv2;
    var c2bi;
    var c2heat;
    var c2vs;
    var c2is;
    var c2_trip_message;
    var str;

    var table = document.getElementById("trip_events");

    var socket = io();

      socket.on('chat message', function(msg){
        var res = msg.split(",");
              // console.log(res[3]);

        // alert(res[3]);
        if(res[3] == ' B'){

          batt_id = res[5];
          batt = [];
          // console.log(batt_id);


          if(batt_id == 1){
               min_vol = res[8];
               max_vol = res[7];

               x[0] = [];
            for(var i=19; i<69; i++) { 
              res[i] = parseInt(res[i], 10);
              batt.push(res[i]);
            } 
               x[0] = batt; 
               if(batt_plotter_selector == 1){
                // console.log("first battery");
                  batt_plotter = x[0];
               }
               // max_vol[0] = Math.max.apply(Math, x[0]);
               // min_vol[0] = Math.min.apply(Math, x[0]);
               // alert(max_vol);
               // batt = [];

          }else if(batt_id == 2){
               min_vol = res[8];
               max_vol = res[7];

              // console.log(res[7]);
              x[1] = [];

            for(var i=19; i<69; i++) { 
              res[i] = parseInt(res[i], 10);
              batt.push(res[i]);
            } 
              x[1] = batt;
               if(batt_plotter_selector == 2){
                // console.log("second battery");

                  batt_plotter = x[1];
               }
          }
          else if(batt_id == 3){
            
                max_currnt_all = res[6];
                // console.log(max_currnt_all);
          }

        }else if(res[3] == 'T'){
          
          batt_id = res[5];
          max_Temp =res[13];
          batt_temp = [];
          console.log(batt_id);


          if(batt_id == 1){
               // min_vol[0] = ras[7];
               // max_vol[0] = res[8]; 
               y[0] = [];
            for(var i=6; i<26; i++) { 
              res[i] = parseInt(res[i], 10);
              batt_temp.push(res[i]);
            } 
               y[0] = batt_temp; 
               if(temp_plotter_selector == 1){
                console.log("first battery temp");
                  temp_plotter = y[0];
                  min_Temp[temp_plotter_selector] = Math.min.apply(Math, y[temp_plotter_selector]);
                  $("#data_two").text(min_Temp[temp_plotter_selector]);  
                  chart.yAxis[0].setExtremes(0,1600);

               }
             
               // alert(max_vol);
               // batt = [];

          }else if(batt_id == 2){
               y[1] = [];
             
            for(var i=6; i<26; i++) { 
              res[i] = parseInt(res[i], 10);
              batt_temp.push(res[i]);
            } 
              y[1] = batt_temp;

               if(temp_plotter_selector == 2){
                // console.log("second battery temp");
                  temp_plotter = y[1];
                  // console.log(temp_plotter);
                  min_Temp[temp_plotter_selector] = Math.min.apply(Math, y[temp_plotter_selector]);
                  $("#data_two").text(min_Temp[temp_plotter_selector]);
                  chart.yAxis[0].setExtremes(0,1600);
               }
             
          }

        }else if(res[3] == 'C'){
          can_l = res[4].toString(); 
          part1 = parseInt(res[5]);
          part2 = parseInt(res[6]);

          // console.log(part1+' '+(part2*consta));
          // console.log(part2);
          tor = part1+(part2*consta);

          if((can_l[0] == "B")&&(can_l[1] == "B")){
            if(tor == 0){
              lef_T=0;

            }else if(tor>0){
              lef_T = ((tor));
            }

             console.log("Wheel left"+lef_T);
          }
          else if((can_l[0] == "B")&&(can_l[1] == "C")){

            if(tor == 0){
              right_T=0;

            }else if(tor>0){
              right_T = 255 - (tor);
            }
              console.log("Wheel right"+right_T);
          }else if(res[4] == 'C1IGBT0'){

              c1igbt0 = res[5];
              c1motor = res[9];
              c1heat = res[8];
              c1vs = res[9];
              c1is = res[10];
              c1_trip_message = res[11];
             
              var i = 0; 
              console.log(c1_trip_message);
              str_1 = "";
      
              if(c1_trip_message[0] == 1){

                str_1 = str_1 + " swUnder Voltage Trip ";

              }else if(c1_trip_message[1] == 1){
                
                str_1 = str_1 + " sw Over current Trip ";

              }else if(c1_trip_message[2] == 1){
        
                str_1 = str_1 + " hw IGBT S/C Trip Zone ";

              }else if(c1_trip_message[3] == 1){

                str_1 = str_1 + " hw Over current Trip zone ";

              }else if(c1_trip_message[4] == 1){

                str_1 = str_1 + " Tripzone fault ";

              }else if(c1_trip_message[8] == 1){

                str_1 = str_1 + " saftey monitoring communication Error ";

              }else if(c1_trip_message[9] == 1){

                str_1 = str_1 + " Resolver Communication Error ";

              }else if(c1_trip_message[10] == 1){

                str_1 = str_1 + " Motor over temperature trip_event ";

              }else if(c1_trip_message[11] == 1){

                str_1 = str_1 + " IGBT over temperature trip ";

              }else {

                str_1 ="";

              }
              var row = table.insertRow(0);
              var cell1 = row.insertCell(0);
              var cell2 = row.insertCell(1);
              cell1.innerHTML = "Error Messege";
              cell2.innerHTML = str_1;


          }else if(res[4] == 'C1IGBT1'){

              c1igbt1 = res[5];
              c1igbt2 = res[6];
              c1motor = res[7];
              c1heat = res[8];
              c1vs = res[9];
              c1is = res[10];

              c1_trip_message = res[11];
             
              var i = 0; 
              console.log(c1_trip_message);
              str = "";
      
              if(c1_trip_message[0] == 1){

                str = str + " swUnder Voltage Trip ";

              }else if(c1_trip_message[1] == 1){
                
                str = str + " sw Over current Trip ";

              }else if(c1_trip_message[2] == 1){
        
                str = str + " hw IGBT S/C Trip Zone ";

              }else if(c1_trip_message[3] == 1){

                str = str + " hw Over current Trip zone ";

              }else if(c1_trip_message[4] == 1){

                str = str + " Tripzone fault ";

              }else if(c1_trip_message[8] == 1){

                str = str + " saftey monitoring communication Error ";

              }else if(c1_trip_message[9] == 1){

                str = str + " Resolver Communication Error ";

              }else if(c1_trip_message[10] == 1){

                str = str + " Motor over temperature trip_event ";

              }else if(c1_trip_message[11] == 1){

                str = str + " IGBT over temperature trip ";

              }else {

                str ="";

              }
              var row = table.insertRow(0);
              var cell1 = row.insertCell(0);
              var cell2 = row.insertCell(1);
              cell1.innerHTML = "Error Messege";
              cell2.innerHTML = str;

              // console.log(str);

          }else if(res[4] == 'C1VI'){

              c1bi = res[5];
              c1bv1 = res[6];
              c1bv2 = res[7];
              c1_trip_message = res[8];

              if(c1_trip_message[0] == 1){

                str = str + " swUnder Voltage Trip ";

              }else if(c1_trip_message[1] == 1){
                
                str = str + " sw Over current Trip ";

              }else if(c1_trip_message[2] == 1){
        
                str = str + " hw IGBT S/C Trip Zone ";

              }else if(c1_trip_message[3] == 1){

                str = str + " hw Over current Trip zone ";

              }else if(c1_trip_message[4] == 1){

                str = str + " Tripzone fault ";

              }else if(c1_trip_message[8] == 1){

                str = str + " saftey monitoring communication Error ";

              }else if(c1_trip_message[9] == 1){

                str = str + " Resolver Communication Error ";

              }else if(c1_trip_message[10] == 1){

                str = str + " Motor over temperature trip_event ";

              }else if(c1_trip_message[11] == 1){

                str = str + " IGBT over temperature trip ";

              }else {

                str ="";

              }
              var row = table.insertRow(0);
              var cell1 = row.insertCell(0);
              var cell2 = row.insertCell(1);
              cell1.innerHTML = "Error Messege";
              cell2.innerHTML = str;

              c1bi = c1bi/10000;
              c1bv1 = c1bv1/100;
              c1bv2 = c1bv2/100;

          }else if(res[4] == 'C2IGBT0'){

              c2igbt1 = res[5];
              c2igbt2 = res[6];
              c2motor = res[7];
              c2heat = res[8];
              c2vs = res[9];
              c2is = res[10];

              c2_trip_message = res[11];
             
              var i = 0; 
              console.log(c2_trip_message);
              str_1 = "";
      
              if(c2_trip_message[0] == 1){

                str_1 = str_1 + " swUnder Voltage Trip ";

              }else if(c2_trip_message[1] == 1){
                
                str_1 = str_1 + " sw Over current Trip ";

              }else if(c2_trip_message[2] == 1){
        
                str_1 = str_1 + " hw IGBT S/C Trip Zone ";

              }else if(c2_trip_message[3] == 1){

                str_1 = str_1 + " hw Over current Trip zone ";

              }else if(c2_trip_message[4] == 1){

                str_1 = str_1 + " Tripzone fault ";

              }else if(c2_trip_message[8] == 1){

                str_1 = str_1 + " saftey monitoring communication Error ";

              }else if(c2_trip_message[9] == 1){

                str_1 = str_1 + " Resolver Communication Error ";

              }else if(c2_trip_message[10] == 1){

                str_1 = str_1 + " Motor over temperature trip_event ";

              }else if(c2_trip_message[11] == 1){

                str_1 = str_1 + " IGBT over temperature trip ";

              }else {

                str_1 ="";

              }
              var row = table.insertRow(0);
              var cell1 = row.insertCell(0);
              var cell2 = row.insertCell(1);
              cell1.innerHTML = "Error Messege";
              cell2.innerHTML = str_1;


          }else if(res[4] == 'C2IGBT1'){

              c2igbt1 = res[5];
              c2igbt2 = res[6];
              c2motor = res[7];
              c2heat = res[8];
              c2vs = res[9];
              c2is = res[10];

              c2_trip_message = res[11];
             
              var i = 0; 
              console.log(c2_trip_message);
              str = "";
      
              if(c2_trip_message[0] == 1){

                str = str + " swUnder Voltage Trip ";

              }else if(c2_trip_message[1] == 1){
                
                str = str + " sw Over current Trip ";

              }else if(c2_trip_message[2] == 1){
        
                str = str + " hw IGBT S/C Trip Zone ";

              }else if(c2_trip_message[3] == 1){

                str = str + " hw Over current Trip zone ";

              }else if(c2_trip_message[4] == 1){

                str = str + " Tripzone fault ";

              }else if(c2_trip_message[8] == 1){

                str = str + " saftey monitoring communication Error ";

              }else if(c2_trip_message[9] == 1){

                str = str + " Resolver Communication Error ";

              }else if(c2_trip_message[10] == 1){

                str = str + " Motor over temperature trip_event ";

              }else if(c2_trip_message[11] == 1){

                str = str + " IGBT over temperature trip ";

              }else {

                str ="";

              }
              var row = table.insertRow(0);
              var cell1 = row.insertCell(0);
              var cell2 = row.insertCell(1);
              cell1.innerHTML = "Error Messege";
              cell2.innerHTML = str;

              // console.log(str);

          }else if(res[4] == 'C2VI'){

              c2bi = res[5];
              c2bv1 = res[6];
              c2bv2 = res[7];
              c2_trip_message = res[8];

              if(c2_trip_message[0] == 1){

                str = str + " swUnder Voltage Trip ";

              }else if(c2_trip_message[1] == 1){
                
                str = str + " sw Over current Trip ";

              }else if(c2_trip_message[2] == 1){
        
                str = str + " hw IGBT S/C Trip Zone ";

              }else if(c2_trip_message[3] == 1){

                str = str + " hw Over current Trip zone ";

              }else if(c2_trip_message[4] == 1){

                str = str + " Tripzone fault ";

              }else if(c2_trip_message[8] == 1){

                str = str + " saftey monitoring communication Error ";

              }else if(c2_trip_message[9] == 1){

                str = str + " Resolver Communication Error ";

              }else if(c2_trip_message[10] == 1){

                str = str + " Motor over temperature trip_event ";

              }else if(c2_trip_message[11] == 1){

                str = str + " IGBT over temperature trip ";

              }else {

                str ="";

              }
              var row = table.insertRow(0);
              var cell1 = row.insertCell(0);
              var cell2 = row.insertCell(1);
              cell1.innerHTML = "Error Messege";
              cell2.innerHTML = str;

              c2bi = c2bi/10000;
              c2bv1 = c2bv1/100;
              c2bv2 = c2bv2/100;

          }else if(res[4] == 'C2VI'){

            
              c2bi = res[5];
              c2bv1 = res[6];
              c2bv2 = res[7];
              c2_trip_message = res[8];

              if(c2_trip_message[0] == 1){

                str = str + " swUnder Voltage Trip ";

              }else if(c2_trip_message[1] == 1){
                
                str = str + " sw Over current Trip ";

              }else if(c2_trip_message[2] == 1){
        
                str = str + " hw IGBT S/C Trip Zone ";

              }else if(c2_trip_message[3] == 1){

                str = str + " hw Over current Trip zone ";

              }else if(c2_trip_message[4] == 1){

                str = str + " Tripzone fault ";

              }else if(c2_trip_message[8] == 1){

                str = str + " saftey monitoring communication Error ";

              }else if(c2_trip_message[9] == 1){

                str = str + " Resolver Communication Error ";

              }else if(c2_trip_message[10] == 1){

                str = str + " Motor over temperature trip_event ";

              }else if(c2_trip_message[11] == 1){

                str = str + " IGBT over temperature trip ";

              }else {

                str ="";

              }
              var row = table.insertRow(0);
              var cell1 = row.insertCell(0);
              var cell2 = row.insertCell(1);
              cell1.innerHTML = "Error Messege";
              cell2.innerHTML = str;

              c2bi = c2bi/10000;
              c2bv1 = c2bv1/100;
              c2bv2 = c2bv2/100;
            }


        }else if(res[3] == 'G'){  
          // console.log(res[4]);
          l1 = res[4]/10000000;
          l2 = res[5]/10000000;
          gmap(l1,l2);

          // console.log(l1);
          // console.log(l2);

            
        }

        longt = l1;
        lati = l2;
   
        var percen = Math.round((max_vol/4000)*100);
        var data = y[1] + " ";

        // alert(parseInt(percen)); 
        // var percen = 60;
                // $('#test').append($('<li>').text(x));
                $("#msg").empty();  
                $("#msg").text(res[3]);  
                $("#msg").append(' '+res[2]); 
                   // this will set the packet number
                     // Geocode an address.
            
                // $("#min_voltage").text(max_Temp);  
                // $("#max_temp").text(max_Temp);  

                $("#data_one").text(max_Temp);  
                $("#data_three").text(min_vol);  
                $("#data_four").text(max_vol);  
              

                $("#data_one_home").text(max_Temp);  
                $("#data_two_home").text(min_Temp);  
                $("#data_three_home").text(max_vol);  
                $("#data_four_home").text(min_vol);  
                $("#data_five").text(max_currnt_all);  
                $("#data_five_home").text(max_currnt_all);  


                $("#theprogressbar").css("height", parseInt(percen));

                $("#can0_1").text(c1igbt0);  
                $("#can1_1").text(c1igbt1);  
                $("#can2_1").text(c1igbt2);  
                $("#can3_1").text(c1motor);  
                $("#can4_1").text(c1heat); 
                $("#can5_1").text(c1vs); 
                $("#can6_1").text(c1is); 
                $("#can7_1").text(c1bi);  
                $("#can8_1").text(c1bv1);  
                $("#can9_1").text(c1bv2);  
                $("#can10_1").text(c1_trip_message);   

                $("#can0_2").text(c2igbt0);  
                $("#can1_2").text(c2igbt1);  
                $("#can2_2").text(c2igbt2);  
                $("#can3_2").text(c2motor);  
                $("#can4_2").text(c2heat);  
                $("#can5_2").text(c2vs); 
                $("#can6_2").text(c1is); 
                $("#can7_2").text(c2bi);  
                $("#can8_2").text(c2bv1);  
                $("#can9_2").text(c1bv2);  
                $("#can10_2").text(c2_trip_message);  
                $("#test").text(res);


                // $('#theprogressbar').attr('width',max_Temp+'%');
                // alertify.notify('packet number - '+data, 'success', 1, function(){  console.log('dismissed'); });
                // $('#theprogressbar').attr('aria-valuenow', max_vol).css('width',max_vol);
                 // function initialize() {
                  // console.log(l1/10000000);
                  // console.log(l2/10000000);
                   
      // }
// 
        // $('#messages').text($('<li>').text(msg));
        // $('#test').append($('<li>').text(msg));
        // $('#test').append($('<li>').text(res));
        // $('#test').append($('<li>').text(int8View));
         // x = res;
      });
 //This is not a highcharts object. It just looks a little like one!
var chartConfig = {
  options: {
      //This is the Main Highcharts chart config. Any Highchart options are valid here.
      //will be overriden by values specified below.
      chart: {
          type: 'bar'
      },
      tooltip: {
          style: {
              padding: 10,
              fontWeight: 'bold'
          }
      }
  },
  //The below properties are watched separately for changes.
  //Series object (optional) - a list of series using normal Highcharts series options.
  series: [{
     data: [10, 15, 12, 8, 7]
  }],
  //Title configuration (optional)
  title: {
     text: 'Hello'
  },
  //Boolean to control showing loading status on chart (optional)
  //Could be a string if you want to show specific loading text.
  loading: false,
  //Configuration for the xAxis (optional). Currently only one x axis can be dynamically controlled.
  //properties currentMin and currentMax provided 2-way binding to the chart's maximum and minimum
  xAxis: {
  currentMin: 0,
  currentMax: 20,
  title: {text: 'values'}
  },
  //Whether to use Highstocks instead of Highcharts (optional). Defaults to false.
  useHighStocks: false,
  //size (optional) if left out the chart will default to size of the div or something sensible.
  size: {
   width: 400,
   height: 300
  },
  //function (optional)
  func: function (chart) {
   //setup some logic for the chart
  }
};
//-------------------------------Battery---------------------------------------------------
       chart = Highcharts.chart('container', {
          chart: {
              renderTo: 'container',
              type: 'column'
          },
           title: {
                  text: 'Battery Monitor'
              },
              subtitle: {
                  text: 'Cell voltage levels'
              },
              yAxis: {
              
                min: 2500,
                max: 3500,
              
               plotLines: [{
                    id: 'limit-min',
                    color: '#FF0000',
                    dashStyle: 'ShortDash',
                    width: 2,
                    value: 3300,
                    zIndex: 0,
                    label : {
                        text : 'min'
                    }
                }, {
                    id: 'limit-max',
                    color: '#008000',
                    dashStyle: 'ShortDash',
                    width: 2,
                    value: 3400,
                    zIndex: 0,
                    label : {
                        text : 'max'
                    }
                }]

              },
          series: [{
              name: 'Battery Cell Voltages',


              data: Math.abs(batt_plotter) % 10000,

              // threshold: 3250,
              // negativeColor: 'green',
              // color: 'red',
              // tooltip: {
              //     valueDecimals: 2
              // }       
          }]

      });

        chat_battery = Highcharts.chart('temp', {
              chart: {
                  type: 'line'
              },
              title: {
                  text: 'Cell Temperatures'
              },
              subtitle: {
                  text: 'Source: VEGA'
              },
              yAxis: {
                  title: {
                      text: 'Temperature (Â°C)'
                  }
              },
              plotOptions: {
                  line: {
                      dataLabels: {
                          enabled: true
                      },
                      enableMouseTracking: true
                  }
              },
              series: [{
                  name: 'Battery cell Temperatures',
                  data: Math.abs(temp_plotter) % 100
              }]
          }); 
//------------------Guage-----------------------------------------------------------
$(function () {
    var gaugeOptions = {
        chart: {
            type: 'solidgauge',
            backgroundColor: '#F6F6F6'
        },
        plotOptions:{
          series: {
            animation: {
                duration :1,
            }

          }

        },
        title: null,
        pane: {
            center: ['50%', '60%'], 
            borderWidth: 0,
            size: '80%',
            startAngle: -90,
            endAngle: 90, 
            background: {
                backgroundColor: (Highcharts.theme && Highcharts.theme.background2) || '#FFF',
                innerRadius: '60%',
                outerRadius: '100%',
                shape: 'arc'
            }
        },
        tooltip: {
            enabled: false
        },
        // the value axis
        yAxis: {
            stops: [
                [0.1, '#55BF3B'], // green
                [0.5, '#DDDF0D'], // yellow
                [0.9, '#DF5353'] // red
            ],
            lineWidth: 0,
            minorTickInterval: null,
            tickAmount: 2,
            title: {
                y: -70
            },
            labels: {
                y: 16
            }
        },
        plotOptions: {
            solidgauge: {
                dataLabels: {
                    y: 5,
                    borderWidth: 0,
                    useHTML: true
                }
            }
        }
    };

    //------------------------Right Torque--------------------------------------------------------------------
    var chartRpm = Highcharts.chart('container-rpm', Highcharts.merge(gaugeOptions, {
        yAxis: {
            min: 0,
            max: 14,
            title: {
                text: 'Right Torque'
            }
        },
        series: [{
            name: 'Right Torque',
            data: [1],
            dataLabels: {
                format: '<div style="text-align:center"><span style="font-size:25px;color:' +
                    ((Highcharts.theme && Highcharts.theme.contrastTextColor) || 'black') + '">{y:.1f}</span><br/>' +
                       '<span style="font-size:12px;color:silver">* 1000 / min</span></div>'
            },
            tooltip: {
                valueSuffix: ' revolutions/min'
            }
        }]
    }));

    setInterval(function () {
        // Speed
        var point,
            newVal,
            inc;
        // RPM
        if (chartRpm) {
            point = chartRpm.series[0].points[0];
            point.update(right_T);
        }
    }, 100);

    //--------------------------------------------------------------------------------------------

    var labba = Highcharts.chart('rcontainer-torque', Highcharts.merge(gaugeOptions, {
        yAxis: {
            min: 0,
            max: 14,
            title: {
                text: 'RPM'
            }
        },
        series: [{
            name: 'RPM',
            data: [1],
            dataLabels: {
                format: '<div style="text-align:center"><span style="font-size:25px;color:' +
                    ((Highcharts.theme && Highcharts.theme.contrastTextColor) || 'black') + '">{y:.1f}</span><br/>' +
                       '<span style="font-size:12px;color:silver">* 1000 / min</span></div>'
            },
            tooltip: {
                valueSuffix: ' revolutions/min'
            }
        }]
    }));
       // Bring life to the dialschartTorque
    setInterval(function () {
        // Speed
        var point,
            newVal,
            inc;
        // RPM
        if (labba) {
            point = labba.series[0].points[0];
            point.update(10);
        }
    }, 2000);
    //----------------------Speed--------------------------------------------------
    var chartlTorque = Highcharts.chart('container-torque', Highcharts.merge(gaugeOptions, {
        yAxis: {
            min: 0,
            max: 14,
            title: {
                text: 'Speed'
            }
        },
        series: [{
            name: 'Speed',
            data: [1],
            dataLabels: {
                format: '<div style="text-align:center"><span style="font-size:25px;color:' +
                    ((Highcharts.theme && Highcharts.theme.contrastTextColor) || 'black') + '">{y:.1f}</span><br/>' +
                       '<span style="font-size:12px;color:silver">* 1000 / min</span></div>'
            },
            tooltip: {
                valueSuffix: ' revolutions/min'
            }
        }]
    }));
       // Bring life to the dialschartTorque
    setInterval(function () {
        // Speed
        var point,
            newVal,
            inc;
        // RPM
        if (chartlTorque) {
            point = chartlTorque.series[0].points[0];
            point.update(0);
        }
    }, 100);
    //---------------------left trg----------------------------------------------------------------
    var lefttrq = Highcharts.chart('container-speed', Highcharts.merge(gaugeOptions, {
        yAxis: {
            min: 0,
            max: 14,
            title: {
                text: 'Left Torque'
            }
        },
        series: [{
            name: 'Left Torque',
            data: [1],
            dataLabels: {
                format: '<div style="text-align:center"><span style="font-size:25px;color:' +
                    ((Highcharts.theme && Highcharts.theme.contrastTextColor) || 'black') + '">{y:.1f}</span><br/>' +
                       '<span style="font-size:12px;color:silver">* 1000 / min</span></div>'
            },
            tooltip: {
                valueSuffix: ' revolutions/min'
            }
        }]
    }));
       // Bring life to the dials
    setInterval(function () {
        // Speed
        var point,
            newVal,
            inc;
        // RPM
        if (lefttrq) {
            point = lefttrq.series[0].points[0];
            point.update(lef_T);
        }
    }, 100);
    //---------------------------------------------------------------------------------------------------
});
function reload(){
  chart.series[0].setData(batt_plotter); 
  chat_battery.series[0].setData(temp_plotter);
}
setInterval(reload, 1000)
function openCity(evt, cityName) {
    var i, tabcontent, tablinks;
    tabcontent = document.getElementsByClassName("tabcontent");
    for (i = 0; i < tabcontent.length; i++) {
        tabcontent[i].style.display = "none";
    }
    tablinks = document.getElementsByClassName("tablinks");
    for (i = 0; i < tablinks.length; i++) {
        tablinks[i].className = tablinks[i].className.replace(" active", "");
    }
    document.getElementById(cityName).style.display = "block";
    evt.currentTarget.className += " active";
}
function Init(){
   openCity(event, 'home');
   // initialize(); 
  
}
function battery_caller(num){
  // alert(data);
   batt_plotter = 0;
   temp_plotter = 0;
   batt_plotter_selector = num;
   temp_plotter_selector = num;
   //console.log(num);
  // range_max = max_vol[num];
  // range_low = min_vol[num];
    var str = "";
    // var str2= "";
    str = "Battery Pack "+batt_plotter_selector+" Voltage";
    str2 = "Battery Pack "+temp_plotter_selector+" Cell Temperatures";

    chart.setTitle({text: str});

    chat_battery.setTitle({text: str2});


            // var max_data = 3200;
            // console.log(chart.yAxis[0]);
            
            // $.each(chart.series[0].data,function(i,data){
                
            //     if(data.y < max)
            //         data.graphic.attr({
            //             fill:'red'
            //         });
                
            // });
            // //  $.each(chart.series[0].data,function(i,data){
                
            //     if(data.y < max)
            //         data.graphic.attr({
            //             fill:'red'
            //         });
                
            // });
      // chart.yAxis[0].max.update({
      //   fill:'red'
      // }); 

  
    // plotLines
    // chart.series.points[10].update({color:'#008000'});



    console.log(batt_plotter_selector);
  // alert(range_low);
}
  var curr_max = 2500;
  var curr_min = 3500;

  var plot_dat;
function max_up(){

// console.log(curr_max);
curr_max = curr_max + 25;
// console.log(curr_max);
// chart.yAxis[0].setExtremes(3500,curr_max);
chart.yAxis[0].update({
    max: curr_max
}); 

// chart.yAxis[0].max = 10000;
// console.log(curr_max);

}
function max_down(){

// console.log(curr_max);
curr_max = curr_max - 25;
// console.log(curr_max);
// chart.yAxis[0].setExtremes(3500,curr_max);
chart.yAxis[0].update({
    max: curr_max
}); 

// chart.yAxis[0].max = 10000;
// console.log(curr_max);

}
function min_up(){

// console.log(curr_max);
curr_min = curr_min + 25;
// console.log(curr_max);
// chart.yAxis[0].setExtremes(3500,curr_max);
chart.yAxis[0].update({
    min: curr_min
}); 

// chart.yAxis[0].max = 10000;
// console.log(curr_max);

}
function min_down(){

// console.log(curr_max);
curr_min = curr_min - 25;
// console.log(curr_max);
// chart.yAxis[0].setExtremes(3500,curr_max);
chart.yAxis[0].update({
    min: curr_min
}); 
// chart.
// chart.yAxis[0].max = 10000;
// console.log(curr_max);

}


     
  </script>
  <script type="text/javascript">
      function gmap(l1,l2) {

        // if((l1 == 0)&&(l2==0)){

        //   l1=6.929912;
        //   l2= 79.861694;

        // }

        var mapOptions = {
            center: new google.maps.LatLng(l1, l2),
            zoom: 40,
            mapTypeId: google.maps.MapTypeId.ROADMAP
        };
        var map = new google.maps.Map(document.getElementById("map_canvas"),
            mapOptions);

      }
    </script>
<style>                        
</style>

</body>
</html>
